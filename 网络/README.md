## 网络相关笔记

***

### TCP/IP网络模式

* 应用层
* 传输层
    - 两个传输协议：TCP(传输控制协议)和UDP
    - TCP特性：流量控制、超时重传、拥塞控制等；TCP最大报文段长度MSS
* 网络层
  结构： IP头部 TCP头部 数据块1
    - IP协议，将传输层的报文作为数据部分，再加上IP包头组装成IP报文，如果IP
      报文大小超过MTU（以太网中一般为1500字节）就会再次进行切片
    - 寻址
    - 路由
* 网络接口层
  通过MAC头部判断网络包目的地

***

#### TCP三次握手

SYN:建立连接 FIN:关闭连接 ACK:响应 PSH:有数据传输 RST:连接重置

* 客户端发起连接SYN，随机一个初始化序列号seq=x,设置SYN=1表示握手报文，
  之后处于SYN-SENT（同步已发送）状态
* 服务端收到发起的连接，随机生成一个初始序列号（server_isn）(seq=y),
  设置ack=x+1,设置SYN=1和ACK=1，表示是一个SYN握手和ACK确认应答报文，
  返回SYN，并且ACK客户端SYN，之后处于SYN-RCVD（同步已接收）状态
* 客户端收到服务端发送的SYN和ACK之后，将ACK置为1，表示是一个应答报文，设置ack=y+1，
  表示收到了服务器的y之前的数据，发送对SYN确认的ACK，之后处于ESTABLISHED（连接已建立）状态，因为
  已经一发一送成功了
* 服务端收到ACK之后，处于ESTABLISHED状态，因为也已经一法一送状态

***

### HTTP(超文本传输协议)

#### 状态码

* 1 XX 提示信息，是协议处理中的一种中间状态
* 2 XX 服务器成功处理了客户端的请求
    - 200 成功
    - 204 No Content 响应头没有body数据
    - 206 Partial Content应用于HTTP分块下载或断点续传，表示响应的返回的body数据并不是资源的全部，只是一部分，
      也是服务器处理成功的状态
* 3 XX 客户端请求的资源发生了变动，需要客户端用新的URL重新发送请求获取资源，也就是重定向
    - 301 永久重定向，请求资源已经不存在，需改用新的URL再次访问
    - 302 Found 表示临时重定向，请求的资源还在，暂时需要用另一个URL访问
    - 304 Not Modified 不具有跳转的含义，资源未修改，重定向到已存在的缓冲文件，也称缓存重定向，
      告诉客户端可以继续使用缓存资源，用于缓存控制
* 4 XX 客户端发送的报文有误，服务器无法处理
    - 400 Bad Request表示客户端请求的报文有错误
    - 403 Forbidden表示服务器禁止访问资源
    - 404 Not Found表示请求的资源不存在
* 5 XX 客户端请求报文正确，但是服务器处理时内部发生了错误
    - 500 服务器发生错误
    - 501 客户端请求的功能还不支持
    - 502 网关或代理时返回的错误码
    - 503 服务器很忙，暂时无法响应客户端

#### 常见字段

Host、 Content-Length(返回数据的长度)、 Connection(使用Tcp持久连接，以便请求复用，Keep-Alive)、
Content-Type(数据格式：text/html;chatset=utf-8)、 Content-encoding(数据压缩方法)、

***

#### GET和POST方法是否是安全和幂等的吗（RFC规范）？

* GET方法获取指定的资源，是安全、幂等、可被缓存的（只读操作）
* POST是新增或提交数据的操作，不安全，不是幂等的，不可缓存
* HTTP传输的内容都是明文的，使用https数据会被加密传输

#### HTTP/2、HTTP/1.1、HTTP/1.0、HTTP/3区别

* http/1.1使用长连接方式、支持管道（pipeline）网络传输，管道问题：没有解决响应的对头阻塞，服务端
  需要按顺序响应收到的请求
* http/2会压缩头，多个请求会消除重复部分（HPACK）
* http/2全面采用二进制格式：头信息帧和数据帧
* http/2每个请求或响应的所有数据包称为数据流都有一个Stream ID,客户端
  建立的stream必须是奇数号，服务器建立的stream必须是偶数号，可以指定stream的优先级
* http/2可以在一个连接中并发多个请求或回应（多路复用）
* http/2服务器推送
* http/2问题：tcp对头阻塞问题，tcp层必须保证收到的字节数据是完整且连续的，当前一个字节
  没有到达时，后收到的字节数据只能存放在内核缓冲区，只有等到这一个字节到达时，http/2应用层才能从
  内核中拿到数据。
* http/3将HTTP下层的TCP协议改成了UDP，增加QUIC协议实现类似TCP的可靠性传输。

***

##### QUIC协议特点

* 无队头阻塞：可以在同一连接上并发传输多个stream，当某个stream丢包是，只会阻塞这个流，其他不收到影响
* 更快的连接建立：握手过程只需要1RTT，确认双方的连接id。QUIC包含TLS协议
* 连接迁移，通过连接id标记通信的两个断点